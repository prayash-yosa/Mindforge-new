<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mindforge Student Experience — Technical Architecture (Final)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light;
        --bg: #f5fbef;
        --panel: #ffffff;
        --border: #c5d4be;
        --text: #503d42;
        --muted: #6b5a5e;
        --accent: #748b75;
        --accent-soft: #e2ebe0;
        --accent-dark: #5a6b5a;
        --code-bg: #2d2527;
        --code-border: #503d42;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        --sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        padding: 2rem 1rem 4rem;
        font-family: var(--sans);
        background: radial-gradient(circle at top, #e2ebe0 0, #f5fbef 40%, #f0f5ec 100%);
        color: var(--text);
      }
      .page {
        max-width: 1000px;
        margin: 0 auto;
        background: var(--panel);
        border-radius: 16px;
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12), 0 0 0 1px rgba(148, 163, 184, 0.3);
        padding: 2.25rem 2.5rem 2.5rem;
      }
      header { border-bottom: 1px solid var(--border); padding-bottom: 1.5rem; margin-bottom: 1.75rem; }
      h1 { margin: 0 0 0.5rem; font-size: 1.9rem; letter-spacing: -0.03em; color: var(--accent-dark); }
      .meta { font-size: 0.9rem; color: var(--muted); }
      h2 {
        margin-top: 2.2rem;
        margin-bottom: 0.75rem;
        font-size: 1.25rem;
        letter-spacing: -0.01em;
        color: var(--accent-dark);
        border-bottom: 2px solid var(--accent-soft);
        padding-bottom: 0.5rem;
      }
      h3 { margin-top: 1.5rem; margin-bottom: 0.35rem; font-size: 1.05rem; color: var(--text); }
      h4 { margin-top: 1.2rem; margin-bottom: 0.25rem; font-size: 0.95rem; color: var(--muted); }
      p { line-height: 1.6; margin: 0.35rem 0 0.75rem; }
      ul, ol { margin: 0.35rem 0 0.9rem 1.25rem; padding: 0; }
      li { margin: 0.15rem 0; line-height: 1.5; }
      table { border-collapse: collapse; width: 100%; margin: 0.5rem 0 1.35rem; font-size: 0.9rem; }
      th, td { border: 1px solid var(--border); padding: 0.55rem 0.65rem; text-align: left; vertical-align: top; }
      th { background: #f3f4f6; font-weight: 600; }
      code { font-family: var(--mono); font-size: 0.88em; background: #f3f4f6; padding: 0.1rem 0.35rem; border-radius: 4px; }
      pre {
        margin: 0.75rem 0 1rem;
        padding: 1rem 1.2rem;
        border-radius: 10px;
        background: var(--code-bg);
        color: #e5e7eb;
        border: 1px solid var(--code-border);
        overflow-x: auto;
        font-size: 0.82rem;
        line-height: 1.45;
      }
      pre code { font-family: var(--mono); background: transparent; padding: 0; }
      .handoff { background: #f0fdf4; border: 1px solid #86efac; border-radius: 10px; padding: 1rem 1.25rem; margin-top: 1.5rem; font-size: 0.9rem; }
      .approved { color: #059669; font-weight: 700; }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <h1>Mindforge Student Experience — Technical Architecture (Final)</h1>
        <p class="meta">
          <strong>Artifact:</strong> Mindforge_Student_Experience_Technical_Architecture_Final<br />
          <strong>Path:</strong> docs/architecture/final/Mindforge_Student_Experience_Technical_Architecture_Final.md<br />
          <strong>Project:</strong> Mindforge Student Experience · <strong>Date:</strong> February 6, 2026 · <strong>Mode:</strong> Architect AI Agent (Final Mode)
        </p>
        <p class="meta"><strong>Constraints locked:</strong> Light Architecture v2; UX Specification (Approved) — no UX or feature changes.</p>
      </header>

      <h2>1. Activated Modes Summary</h2>
      <table>
        <thead><tr><th>Mode</th><th>Trigger</th><th>Application</th></tr></thead>
        <tbody>
          <tr><td><strong>Strategy & Discovery</strong></td><td>Multi-platform, single backend, sync</td><td>Architecture boundaries; no scope creep.</td></tr>
          <tr><td><strong>Governance & Architecture Lock</strong></td><td>UX approved</td><td>Technical contract; no feature additions.</td></tr>
          <tr><td><strong>AI-First / Cloud-Native</strong></td><td>AI roles, India single-region</td><td>AI components, cost tiers, deployment.</td></tr>
          <tr><td><strong>Security-by-Design</strong></td><td>PII, MPIN, educational/attendance data</td><td>AuthN/AuthZ, data protection, threats.</td></tr>
        </tbody>
      </table>

      <h2>2. Assumptions & Constraints</h2>
      <h3>Assumptions</h3>
      <ul>
        <li>Identity provisioning done elsewhere; this architecture consumes student identity and MPIN verification only.</li>
        <li>NotebookLM daily feeds available read-only; fallback to syllabus-level content when missing.</li>
        <li>Attendance source TBD; student-facing UX read-only; no self-correction.</li>
        <li>Single region (India); no multi-region in this phase.</li>
        <li>Partial caching and queued actions; no full offline in v1.</li>
      </ul>
      <h3>Constraints (Light Architecture + UX)</h3>
      <ul>
        <li>UX locked: screens, navigation (Home, Attendance, Doubts, Profile), flows per UX spec.</li>
        <li>6-digit MPIN only; rate limiting and lockout mandatory.</li>
        <li>AI: progressive guidance; syllabus-aligned only.</li>
        <li>Platforms: Android, iOS, desktop; shared backend and data; sync.</li>
        <li>Low bandwidth; minimal PII to AI (pseudonymous IDs).</li>
      </ul>

      <h2>3. High-Level Architecture</h2>
      <h3>3.1 Components</h3>
      <table>
        <thead><tr><th>Layer</th><th>Component</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>Client</td><td>UI / Navigational layer</td><td>Android, iOS, Web. Routes/screens (Login, Home, Activity, Results, Attendance, Doubts, Profile); bottom nav/sidebar; UX states per spec.</td></tr>
          <tr><td>Client</td><td>API client / sync</td><td>REST over HTTPS; auth token; optional offline queue and sync state.</td></tr>
          <tr><td>Backend</td><td>API / Gateway layer</td><td>REST API; validation; auth; rate limiting; route to business layer.</td></tr>
          <tr><td>Backend</td><td>Business logic layer (middle layer)</td><td>Application services: auth, today’s plan, activities, grading, AI orchestration, attendance, doubts. No direct DB access.</td></tr>
          <tr><td>Backend</td><td>Data access layer (DB interaction)</td><td>Repositories/DAOs: CRUD and queries. Only layer that talks to DB.</td></tr>
          <tr><td>Backend</td><td>Database</td><td>Persistent store: students, syllabus, activities, responses, attendance, doubts, sessions.</td></tr>
          <tr><td>External</td><td>NotebookLM</td><td>Read-only teaching feed.</td></tr>
          <tr><td>External</td><td>AI provider(s)</td><td>Stateless; no persistent student data.</td></tr>
        </tbody>
      </table>
      <h3>3.2 Responsibilities</h3>
      <p><strong>UI / Navigational layer:</strong> Render screens per UX; manage routes; loading/error/offline states; call API client.</p>
      <p><strong>API layer:</strong> Validate; authenticate; rate limit; delegate to business layer; return consistent JSON/HTTP.</p>
      <p><strong>Business logic layer:</strong> Use cases (login, today’s plan, submit answer, AI feedback, attendance, doubts); call data access and external services.</p>
      <p><strong>Data access layer:</strong> All DB reads/writes; map domain ↔ DB.</p>
      <h3>3.3 Communication</h3>
      <p>Client ↔ Backend: REST over HTTPS, JSON, Bearer token. API → Business → Data: in-process. Business → AI / NotebookLM: HTTP.</p>

      <h2>4. Technology Stack</h2>
      <table>
        <thead><tr><th>Area</th><th>Choices</th><th>Rationale</th></tr></thead>
        <tbody>
          <tr><td>Frontend</td><td>React Native (or Flutter) for mobile; React (or Next.js) for web</td><td>Shared UX and API contract.</td></tr>
          <tr><td>Backend</td><td>Stateless API (e.g. Node/Express, Java/Spring, Go)</td><td>Horizontal scaling; clear API / Business / Data separation.</td></tr>
          <tr><td>Data</td><td>PostgreSQL (or MySQL); optional Redis (sessions, rate limits)</td><td>Relational model; Redis for limits/session.</td></tr>
          <tr><td>Cloud & DevOps</td><td>Single region (India); LB; containers; managed DB; secrets vault</td><td>Aligns with single-region assumption.</td></tr>
          <tr><td>AI</td><td>LLM via provider API; deterministic grading where possible</td><td>Stateless; cost tiering.</td></tr>
        </tbody>
      </table>

      <h2>5. API & Data Model Overview</h2>
      <h3>5.1 Database (High-Level)</h3>
      <ul>
        <li><strong>students</strong>: id, external_id, class, board, school, display_name, MPIN hash, consent.</li>
        <li><strong>syllabus_metadata</strong>: class, board, subject, chapter, topic.</li>
        <li><strong>teaching_feed</strong>: NotebookLM daily summaries (class, date, summary).</li>
        <li><strong>activities</strong>: student_id, type, syllabus ref, status, created_at, due_at.</li>
        <li><strong>questions</strong>: syllabus ref, type, content, rubric.</li>
        <li><strong>responses</strong>: student_id, question_id, activity_id, attempt, score, feedback_level.</li>
        <li><strong>attendance</strong>: student_id, date, status (present/absent), source_label.</li>
        <li><strong>doubt_threads</strong>: student_id, syllabus context, messages.</li>
        <li><strong>sessions</strong>: student_id, token/session_id, device, expires_at.</li>
        <li><strong>audit_log</strong>: sensitive operations.</li>
      </ul>
      <h3>5.2 API Endpoints (Logical)</h3>
      <p>All go through API → Business → Data. Auth required unless noted.</p>
      <table>
        <thead><tr><th>Domain</th><th>Method</th><th>Path (logical)</th><th>Purpose</th></tr></thead>
        <tbody>
          <tr><td>Auth</td><td>POST</td><td>/auth/mpin/verify</td><td>Verify MPIN; return token; rate limit/lockout</td></tr>
          <tr><td>Auth</td><td>POST</td><td>/auth/lockout/status</td><td>Check lockout state</td></tr>
          <tr><td>Auth</td><td>POST</td><td>/auth/forgot-mpin</td><td>Initiate MPIN recovery</td></tr>
          <tr><td>Today’s plan</td><td>GET</td><td>/student/today</td><td>Tasks, progress summary</td></tr>
          <tr><td>Activities</td><td>GET</td><td>/student/activities/:type/:id</td><td>Get activity + questions</td></tr>
          <tr><td>Activities</td><td>POST</td><td>/student/activities/:type/:id/respond</td><td>Submit answer; evaluate; AI feedback</td></tr>
          <tr><td>Activities</td><td>GET</td><td>/student/activities/:type/:id/feedback</td><td>Get next AI feedback level</td></tr>
          <tr><td>Activities</td><td>POST</td><td>/student/activities/:type/:id/pause</td><td>Save progress, pause</td></tr>
          <tr><td>Results</td><td>GET</td><td>/student/results/:type/:id</td><td>Score, breakdown, next suggestions</td></tr>
          <tr><td>Attendance</td><td>GET</td><td>/student/attendance</td><td>Summary + calendar (period param)</td></tr>
          <tr><td>Doubts</td><td>GET/POST</td><td>/student/doubts, /student/doubts/:threadId</td><td>List/create thread; get messages; syllabus context</td></tr>
          <tr><td>Syllabus</td><td>GET</td><td>/student/syllabus/tree</td><td>Class → Subject → Chapter → Topic (Doubts selector)</td></tr>
          <tr><td>Profile</td><td>GET</td><td>/student/profile</td><td>Display name, class, progress overview</td></tr>
          <tr><td>Sync</td><td>GET</td><td>/student/sync/status</td><td>Last sync; conflict hint</td></tr>
        </tbody>
      </table>

      <h2>6. Error Handling Strategy</h2>
      <ul>
        <li><strong>API:</strong> Consistent shape <code>{ code, message, details? }</code>; 400/401/403/404/429/500/503.</li>
        <li><strong>Business:</strong> Domain exceptions (InvalidMPIN, LockedOut, etc.); map to API codes; no stack to client.</li>
        <li><strong>Data:</strong> Retry on transient DB errors; 409 or domain message for duplicates.</li>
        <li><strong>AI:</strong> Timeout → fallback hint; provider error → “Try again?” + optional cached hint.</li>
        <li><strong>Client (per UX):</strong> Inline validation; retry; offline/sync/conflict modals.</li>
      </ul>

      <h2>7. Deployment Assumptions</h2>
      <ul>
        <li>Single region (India); HTTPS LB; stateless API; managed DB; secrets in vault; CI/CD; DB migrations versioned; monitoring and health checks.</li>
      </ul>

      <h2>8. Security Architecture</h2>
      <p><strong>AuthN:</strong> 6-digit MPIN verified by backend; short-lived token/session; Bearer/cookie. <strong>AuthZ:</strong> All student endpoints scoped by student_id. <strong>Data:</strong> HTTPS; encryption at rest; minimal PII in AI prompts. <strong>Threats:</strong> Rate limit/lockout on MPIN; validation and parameterized queries; audit log.</p>

      <h2>9. AI Architecture & Governance</h2>
      <p>LLM for doubt/concept; deterministic or cheaper evaluation for MCQs. Prompts: syllabus context + pseudonymous IDs; responses validated before storage. Cost/drift: tier usage; token caps; periodic review.</p>

      <h2>10. Key Technical Decisions & Trade-offs</h2>
      <table>
        <thead><tr><th>Decision</th><th>Trade-off</th></tr></thead>
        <tbody>
          <tr><td>Three-tier backend (API → Business → Data)</td><td>Separation vs. extra hops; chosen for maintainability.</td></tr>
          <tr><td>Single DB (PostgreSQL)</td><td>Simplicity/ACID vs. eventual read replicas.</td></tr>
          <tr><td>REST over HTTPS</td><td>Wide support vs. no built-in real-time; poll/SSE acceptable.</td></tr>
          <tr><td>MPIN-only auth</td><td>UX vs. weaker security; mitigated by rate limit, lockout.</td></tr>
          <tr><td>Attendance read-only for student</td><td>Trust/consistency vs. no self-correction.</td></tr>
        </tbody>
      </table>

      <h2>11. Risks & Mitigations</h2>
      <table>
        <thead><tr><th>Risk</th><th>Mitigation</th></tr></thead>
        <tbody>
          <tr><td>R1: AI hallucination / off-syllabus</td><td>Ground in syllabus + NotebookLM; validation; flag uncertainty.</td></tr>
          <tr><td>R2: Over-helping</td><td>Enforce guidance levels; gate full solution; UX help level.</td></tr>
          <tr><td>R3: Grading fairness</td><td>Deterministic for objective; clear explanations.</td></tr>
          <tr><td>R4: Data privacy (minors)</td><td>Minimal PII to AI; consent; encryption; deletion path.</td></tr>
          <tr><td>R5: NotebookLM feed quality</td><td>Fallback to syllabus content; label source.</td></tr>
          <tr><td>R6: Connectivity</td><td>Cache; retry; offline/sync states in UI.</td></tr>
          <tr><td>R7: MPIN brute-force</td><td>Rate limit; lockout; optional biometric.</td></tr>
          <tr><td>R8: Attendance accuracy</td><td>Read-only; label period/source.</td></tr>
        </tbody>
      </table>

      <h2>12. System Architecture Diagram (PDF-Ready)</h2>
      <pre><code>┌─────────────────────────────────────────────────────────────────────────────────┐
│                        MINDFORGE STUDENT EXPERIENCE                              │
│                     EXECUTION TECHNICAL ARCHITECTURE                             │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
  │   ANDROID APP    │  │    iOS APP       │  │   DESKTOP WEB    │
  │  (UI + Nav +     │  │  (UI + Nav +     │  │  (UI + Nav +     │
  │   API Client)    │  │   API Client)    │  │   API Client)    │
  └────────┬─────────┘  └────────┬─────────┘  └────────┬─────────┘
           │                     │                     │
           │    HTTPS / REST     │                     │
           └─────────────────────┼─────────────────────┘
                                 │
                                 ▼
  ┌──────────────────────────────────────────────────────────────────────────────┐
  │                           API LAYER (Gateway)                                 │
  │  Auth · Rate limit · Validation · Route to Business Layer                     │
  └──────────────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
  ┌──────────────────────────────────────────────────────────────────────────────┐
  │                    BUSINESS LOGIC LAYER (Middle Layer)                        │
  │  Auth · Today's plan · Activities · Grading · AI orchestration · Attendance  │
  │  Doubts · Syllabus context · Sync/conflict · No direct DB access             │
  └──────────────┬───────────────────────────────────────┬───────────────────────┘
                 │                                       │
                 │                                       │ HTTP
                 ▼                                       ▼
  ┌──────────────────────────────┐    ┌─────────────────────────────────────────┐
  │  DATA ACCESS LAYER          │    │  EXTERNAL                                │
  │  (DB interaction only)      │    │  · AI provider (stateless)               │
  │  Repositories / DAOs        │    │  · NotebookLM (read-only feed)           │
  └──────────────┬───────────────┘    └─────────────────────────────────────────┘
                 │
                 ▼
  ┌──────────────────────────────┐    ┌─────────────────────────────────────────┐
  │  DATABASE                    │    │  REDIS (optional)                       │
  │  PostgreSQL (or MySQL)       │    │  Sessions · Rate limits · Cache          │
  │  students · syllabus ·      │    └─────────────────────────────────────────┘
  │  activities · responses ·   │
  │  attendance · doubts ·      │
  │  sessions · audit           │
  └──────────────────────────────┘

  NAVIGATION (UI LAYER):  Login → Home → Activity | Attendance | Doubts | Profile
                         Activity → Results → Home
  UX LOCKED: No change to screens, flows, or features per approved UX spec.</code></pre>

      <h2>13. Approval Decision</h2>
      <p class="approved">Architecture Approved — downstream work may proceed.</p>
      <p>This technical architecture is execution-ready and respects Light Architecture v2 and the approved UX Specification. No UX or feature additions.</p>

      <h2>14. Artifacts to Save</h2>
      <ul>
        <li><strong>Primary:</strong> docs/architecture/final/Mindforge_Student_Experience_Technical_Architecture_Final.md</li>
        <li><strong>Export:</strong> docs/architecture/final/Mindforge_Student_Experience_Technical_Architecture_Final.html</li>
      </ul>

      <h2>STANDARD HANDOFF – To Planner Agent</h2>
      <div class="handoff">
        <p><strong>PROJECT:</strong> Mindforge Student Experience</p>
        <p><strong>ARTIFACT SOURCE:</strong> docs/architecture/final/Mindforge_Student_Experience_Technical_Architecture_Final.md</p>
        <p><strong>ARCHITECTURE STATUS:</strong> Approved — downstream work may proceed.</p>
        <p><strong>WHAT THE PLANNER RECEIVES:</strong> Frontend (UI/nav + API client); Backend (API, Business, Data layers); Database (schema/migrations); API endpoints; Error handling; Deployment; Risks/trade-offs.</p>
        <p><strong>CONSTRAINTS:</strong> UX locked; Light Architecture v2. No feature additions.</p>
        <p><strong>PLANNER NEXT STEPS:</strong> Produce execution plan (phases/sprints); allocate Frontend, Backend, DB, Integration, DevOps; no UX or feature changes.</p>
        <p><strong>DEPENDENCIES:</strong> Light Architecture v2; UX Design Specification.</p>
        <p><strong>Signature:</strong> Architect AI Agent (Final Mode) – Mindforge Student Experience</p>
      </div>
    </div>
  </body>
</html>
